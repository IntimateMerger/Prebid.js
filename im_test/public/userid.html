<!DOCTYPE html>
<html lang="en">

<head>
  <title>User ID Modules Example</title>

  <script>
    var FAILSAFE_TIMEOUT = 2000;

    var adUnits = [
      {
        code: 'test-div',
        sizes: [
          [300, 250],
          [728, 90]
        ],
        bids: [{
          bidder: 'pubmatic',
          params: {
            publisherId: '156209',               // required, must be a string, not an integer or other js type.
            outstreamAU: 'renderer_test_pubmatic',   // required if mediaTypes-> video-> context is 'outstream' and optional if renderer is defined in adUnits or in mediaType video. This value can be get by BlueBillyWig Team.
            adSlot: 'pubmatic_test2',            // optional, must be a string, not an integer or other js type.
            pmzoneid: 'zone1, zone11',           // optional
            lat: '40.712775',                    // optional
            lon: '-74.005973',                   // optional
            yob: '1982',                         // optional
            kadpageurl: 'www.test.com',          // optional
            gender: 'M',                         // optional
            kadfloor: '0.50',                    // optional
            currency: 'AUD',                     // optional (Value configured only in the 1st adunit will be passed on. < br/> Values if present in subsequent adunits, will be ignored.)
            dctr: 'key1=123|key2=345',            // optional (Value configured only in the 1st adunit will be passed on. < br/> Values if present in subsequent adunits, will be ignored.)
            bcat: ['IAB1-5', 'IAB1-7'],                // Optional: Blocked IAB Categories. (Values from all slots will be combined and only unique values will be passed. An array of strings only. Each category should be a string of a length of more than 3 characters.)
            deals: ['deal-id-1', 'deal-id-200']   // optional: PMP Deals, should be array of strings
          }
        }]
      }
    ];

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];
  </script>
  <script src="./prebid.js" async></script>

  <script>
    function getHashedEmail() { }
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    googletag.cmd.push(function () {
      googletag.pubads().disableInitialLoad();
    });

    pbjs.que.push(function () {
      pbjs.setConfig({
        "debug": true,
        "userSync": {
          "userIds": [
            {
              "name": "imuid",
              "params": {
                "cid": 5126 // Set your Intimate Merger Customer ID here for production
              }
            },
          ],
          "syncDelay": 5000,
          "auctionDelay": 1000
        }
      });
      pbjs.addAdUnits(adUnits);
      pbjs.requestBids({
        bidsBackHandler: sendAdserverRequest
      });
    });

    function sendAdserverRequest() {
      if (pbjs.adserverRequestSent) return;
      pbjs.adserverRequestSent = true;
      googletag.cmd.push(function () {
        pbjs.que.push(function () {
          pbjs.setTargetingForGPTAsync();
          googletag.pubads().refresh();
        });
      });
    }

    setTimeout(function () {
      sendAdserverRequest();
    }, FAILSAFE_TIMEOUT);
  </script>

  <script>
    (function () {
      var gads = document.createElement('script');
      gads.async = true;
      gads.type = 'text/javascript';
      gads.src = 'https://securepubads.g.doubleclick.net/tag/js/gpt.js';
      var node = document.getElementsByTagName('script')[0];
      node.parentNode.insertBefore(gads, node);
    })();
  </script>

  <script>
    googletag.cmd.push(function () {
      googletag.defineSlot('/112115922/FL_PB_MedRect', [[300, 250], [300, 600], [728, 90]], 'test-div').addService(googletag.pubads());
      googletag.pubads().enableSingleRequest();
      googletag.enableServices();
    });
  </script>
</head>

<body>
  <h2>User ID Modules Example</h2>

  <h4>Generated EIDs</h4>
  <script>
    pbjs.que.push(function () {
      var idsDiv = document.getElementById('ids-div');
      idsDiv.innerHTML = JSON.stringify(pbjs.getUserIdsAsEids(), null, ' ');
    });
  </script>
  <pre id="ids-div" style="border:1px solid #333; padding:5px; overflow: scroll"></pre>

  <h4>Ad Slot</h4>
  <div id="test-div" style="border:1px solid #333; padding:5px;">
    <script>
      googletag.cmd.push(function () { googletag.display('test-div'); });
    </script>
  </div>
</body>

</html>
